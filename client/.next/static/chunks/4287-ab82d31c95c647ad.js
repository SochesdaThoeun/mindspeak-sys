"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4287],{54287:(e,a,s)=>{s.d(a,{ET:()=>v,Ay:()=>w,VM:()=>c,Lx:()=>u,y4:()=>i,DY:()=>n,ej:()=>g,eg:()=>p});var r=s(66439),t=s(13984);let o={register:async e=>{try{let a;if(console.log("\uD83D\uDD10 Auth Service: Starting user registration",{email:e.email,name:e.name,isAnonymous:e.is_anonymous||!1}),e.avatar){let s=new FormData;s.append("name",e.name),s.append("email",e.email),s.append("password",e.password),s.append("password_confirmation",e.password_confirmation),e.bio&&s.append("bio",e.bio),s.append("is_anonymous",e.is_anonymous?"true":"false"),s.append("avatar",e.avatar),console.log("\uD83D\uDCCE Auth Service: Avatar file attached for registration"),a=await t.FH.post("/register",s,{headers:{"Content-Type":"multipart/form-data"}})}else{let s={name:e.name,email:e.email,password:e.password,password_confirmation:e.password_confirmation,bio:e.bio||"",is_anonymous:e.is_anonymous};console.log("\uD83D\uDCE4 Auth Service: Sending JSON registration payload",{...s,password:"[REDACTED]",password_confirmation:"[REDACTED]"}),a=await t.FH.post("/register",s,{headers:{"Content-Type":"application/json"}})}return a.data.success&&a.data.data.token&&((0,t.O5)(a.data.data.token,a.data.data.user),console.log("✅ Auth Service: Registration successful",{userId:a.data.data.user.id,userName:a.data.data.user.name,userRole:a.data.data.user.role,tokenReceived:!!a.data.data.token})),a.data}catch(n){var a,s,r,o,l,d;console.error("❌ Auth Service: Registration failed",{error:(null==(a=n.response)?void 0:a.data)||n.message,status:null==(s=n.response)?void 0:s.status});let e=(null==(o=n.response)||null==(r=o.data)?void 0:r.message)||"Registration failed",t=null==(d=n.response)||null==(l=d.data)?void 0:l.errors;throw{...n,response:{...n.response,data:{success:!1,message:e,errors:t}}}}},login:async e=>{try{console.log("\uD83D\uDD10 Auth Service: Starting user login",{email:e.email});let a=await t.FH.post("/login",e);return a.data.success&&a.data.data.token&&((0,t.O5)(a.data.data.token,a.data.data.user),console.log("✅ Auth Service: Login successful",{userId:a.data.data.user.id,userName:a.data.data.user.name,userRole:a.data.data.user.role,tokenReceived:!!a.data.data.token})),a.data}catch(n){var a,s,r,o,l,d;console.error("❌ Auth Service: Login failed",{error:(null==(a=n.response)?void 0:a.data)||n.message,status:null==(s=n.response)?void 0:s.status});let e=(null==(o=n.response)||null==(r=o.data)?void 0:r.message)||"Login failed",t=null==(d=n.response)||null==(l=d.data)?void 0:l.errors;throw{...n,response:{...n.response,data:{success:!1,message:e,errors:t}}}}},logout:async()=>{try{console.log("\uD83D\uDD10 Auth Service: Starting user logout");let e=await t.FH.post("/logout");return e.data.success&&console.log("✅ Auth Service: Logout successful"),(0,t.rG)(),e.data}catch(s){var e,a;return console.error("❌ Auth Service: Logout failed",{error:(null==(e=s.response)?void 0:e.data)||s.message,status:null==(a=s.response)?void 0:a.status}),(0,t.rG)(),console.log("⚠️ Auth Service: Logout failed on server but performed complete auth clearance"),{success:!0,message:"Logged out locally"}}},getUserProfile:async()=>{try{console.log("\uD83D\uDD10 Auth Service: Fetching user profile");let e=await t.FH.get("/user/profile");return e.data.success&&console.log("✅ Auth Service: Profile fetched successfully",{userId:e.data.data.id,userName:e.data.data.name,responseStructure:"response.data.data contains user directly"}),{success:e.data.success,data:{user:e.data.data}}}catch(t){var e,a,s,r;throw console.error("❌ Auth Service: Failed to fetch profile",{error:(null==(e=t.response)?void 0:e.data)||t.message,status:null==(a=t.response)?void 0:a.status}),{...t,response:{...t.response,data:{success:!1,message:(null==(r=t.response)||null==(s=r.data)?void 0:s.message)||"Failed to fetch profile"}}}}},updateUserProfile:async e=>{var a,s,r,o,l,d,n,u;try{let r;if(console.log("\uD83D\uDD10 Auth Service: Updating user profile",{hasName:!!e.name,hasBio:!!e.bio,hasAvatar:!!e.avatar,willUseFormData:!!e.avatar}),e.avatar){let a=new FormData;e.name&&a.append("name",e.name),void 0!==e.bio&&a.append("bio",e.bio),a.append("avatar",e.avatar),console.log("\uD83D\uDCCE Auth Service: Using FormData for file upload"),r=await t.FH.put("/user/profile",a,{headers:{"Content-Type":"multipart/form-data"}})}else{let a={};e.name&&(a.name=e.name),void 0!==e.bio&&(a.bio=e.bio),console.log("\uD83D\uDCE4 Auth Service: Using JSON payload",a),r=await t.FH.put("/user/profile",a,{headers:{"Content-Type":"application/json"}})}return r.data.success&&console.log("✅ Auth Service: Profile updated successfully",{userId:r.data.data.id,userName:r.data.data.name,userBio:(null==(a=r.data.data.bio)?void 0:a.substring(0,50))+((null==(s=r.data.data.bio)?void 0:s.length)>50?"...":""),hasAvatar:!!r.data.data.avatar,avatarUrl:r.data.data.avatar,responseStructure:{success:r.data.success,hasUserData:!!r.data.data,userKeys:Object.keys(r.data.data||{}),actualStructure:"response.data.data contains user directly"}}),{success:r.data.success,data:{user:r.data.data}}}catch(s){console.error("❌ Auth Service: Failed to update profile",{error:(null==(r=s.response)?void 0:r.data)||s.message,status:null==(o=s.response)?void 0:o.status});let e=(null==(d=s.response)||null==(l=d.data)?void 0:l.message)||"Failed to update profile",a=null==(u=s.response)||null==(n=u.data)?void 0:n.errors;throw{...s,response:{...s.response,data:{success:!1,message:e,errors:a}}}}},updatePassword:async e=>{try{console.log("\uD83D\uDD10 Auth Service: Updating user password");let a=await t.FH.put("/user/password",e,{headers:{"Content-Type":"application/json"}});return a.data.success&&console.log("✅ Auth Service: Password updated successfully",{message:a.data.message}),a.data}catch(n){var a,s,r,o,l,d;console.error("❌ Auth Service: Failed to update password",{error:(null==(a=n.response)?void 0:a.data)||n.message,status:null==(s=n.response)?void 0:s.status});let e=(null==(o=n.response)||null==(r=o.data)?void 0:r.message)||"Failed to update password",t=null==(d=n.response)||null==(l=d.data)?void 0:l.errors;throw{...n,response:{...n.response,data:{success:!1,message:e,errors:t}}}}},checkAuthStatus:async()=>{try{console.log("\uD83D\uDD10 Auth Service: Checking authentication status");let e=await t.FH.get("/user/profile"),a=e.data.success&&!!e.data.data;return console.log("✅ Auth Service: Auth status checked",{isAuthenticated:a,userId:a?e.data.data.id:null}),a}catch(a){var e;return console.log("⚠️ Auth Service: User not authenticated",{status:(null==(e=a.response)?void 0:e.status)||"Network Error"}),!1}},refreshUser:async()=>{try{console.log("\uD83D\uDD10 Auth Service: Refreshing user data");let e=await o.getUserProfile();return console.log("✅ Auth Service: User data refreshed successfully"),e}catch(e){return console.error("❌ Auth Service: Failed to refresh user data:",e),null}}},l=e=>{var a,s,r;let t=[],o=(null==(s=e.response)||null==(a=s.data)?void 0:a.error)||(null==(r=e.response)?void 0:r.data);return(null==o?void 0:o.errors)&&Object.values(o.errors).forEach(e=>{Array.isArray(e)&&t.push(...e)}),0===t.length&&(null==o?void 0:o.message)&&t.push(o.message),0===t.length&&e.message&&t.push(e.message),t.length>0?t:["An unexpected error occurred"]},d=(0,r.zD)("auth/checkAuthStatus",async(e,a)=>{let{rejectWithValue:s}=a;try{if(console.log("\uD83D\uDCE4 Auth Slice: Checking authentication status"),await o.checkAuthStatus())return(await o.getUserProfile()).data.user;return null}catch(e){return console.error("❌ Auth Slice: Auth status check failed",e.message),s({errors:["Failed to check authentication status"]})}}),n=(0,r.zD)("auth/register",async(e,a)=>{let{rejectWithValue:s}=a;try{return console.log("\uD83D\uDCE4 Auth Slice: Starting user registration"),(await o.register(e)).data}catch(e){var r;return console.error("❌ Auth Slice: Registration failed",(null==(r=e.response)?void 0:r.data)||e.message),s({errors:l(e)})}}),u=(0,r.zD)("auth/login",async(e,a)=>{let{rejectWithValue:s}=a;try{return console.log("\uD83D\uDCE4 Auth Slice: Starting user login"),(await o.login(e)).data}catch(e){var r;return console.error("❌ Auth Slice: Login failed",(null==(r=e.response)?void 0:r.data)||e.message),s({errors:l(e)})}}),i=(0,r.zD)("auth/logout",async()=>{try{return console.log("\uD83D\uDCE4 Auth Slice: Starting user logout"),await o.logout(),!0}catch(a){var e;return console.error("❌ Auth Slice: Logout failed",(null==(e=a.response)?void 0:e.data)||a.message),!0}}),c=(0,r.zD)("auth/getUserProfile",async(e,a)=>{let{rejectWithValue:s}=a;try{return console.log("\uD83D\uDCE4 Auth Slice: Fetching user profile"),(await o.getUserProfile()).data.user}catch(e){var r;return console.error("❌ Auth Slice: Get profile failed",(null==(r=e.response)?void 0:r.data)||e.message),s({errors:l(e)})}}),p=(0,r.zD)("auth/updateProfile",async(e,a)=>{let{rejectWithValue:s}=a;try{return console.log("\uD83D\uDCE4 Auth Slice: Updating user profile"),(await o.updateUserProfile(e)).data.user}catch(e){var r;return console.error("❌ Auth Slice: Update profile failed",(null==(r=e.response)?void 0:r.data)||e.message),s({errors:l(e)})}}),g=(0,r.zD)("auth/updatePassword",async(e,a)=>{let{rejectWithValue:s}=a;try{return console.log("\uD83D\uDCE4 Auth Slice: Updating user password"),(await o.updatePassword(e)).data.message}catch(e){var r;return console.error("❌ Auth Slice: Update password failed",(null==(r=e.response)?void 0:r.data)||e.message),s({errors:l(e)})}}),h=(0,r.zD)("auth/refreshUserData",async(e,a)=>{let{rejectWithValue:s}=a;try{console.log("\uD83D\uDCE4 Auth Slice: Refreshing user data");let e=await o.refreshUser();if(e)return e.data.user;throw Error("Failed to refresh user data")}catch(e){return console.error("❌ Auth Slice: Refresh user data failed",e.message),s({errors:["Failed to refresh user data"]})}}),f=(0,r.Z0)({name:"auth",initialState:{user:null,token:null,isAuthenticated:!1,isLoading:!1,error:null},reducers:{clearError:e=>{e.error=null,console.log("✅ Auth Slice: Error cleared")},clearAuth:e=>{e.user=null,e.token=null,e.isAuthenticated=!1,e.error=null,console.log("✅ Auth Slice: Auth data cleared")},setLoading:(e,a)=>{e.isLoading=a.payload},setUser:(e,a)=>{e.user=a.payload,console.log("✅ Auth Slice: User data updated",{userId:a.payload.id,userName:a.payload.name})},forceUpdateUser:(e,a)=>{e.user={...a.payload},e.lastUpdated=Date.now(),console.log("\uD83D\uDD04 Auth Slice: Force user update with timestamp",{userId:a.payload.id,userName:a.payload.name,timestamp:e.lastUpdated})}},extraReducers:e=>{e.addCase(d.pending,e=>{e.isLoading=!0,console.log("⏳ Auth Slice: Auth status check pending")}).addCase(d.fulfilled,(e,a)=>{e.isLoading=!1,a.payload?(e.user=a.payload,e.isAuthenticated=!0,console.log("✅ Auth Slice: Auth status check successful - user authenticated",{user:a.payload.name})):(e.user=null,e.isAuthenticated=!1,console.log("✅ Auth Slice: Auth status check successful - user not authenticated")),e.error=null}).addCase(d.rejected,(e,a)=>{e.isLoading=!1,e.user=null,e.isAuthenticated=!1;let s=a.payload;e.error=(null==s?void 0:s.errors)||[(null==s?void 0:s.message)||"Auth status check failed"],console.log("❌ Auth Slice: Auth status check rejected",e.error)}),e.addCase(n.pending,e=>{e.isLoading=!0,e.error=null,console.log("⏳ Auth Slice: Registration pending")}).addCase(n.fulfilled,(e,a)=>{e.isLoading=!1,e.user=a.payload.user,e.token=a.payload.token,e.isAuthenticated=!0,e.error=null,console.log("✅ Auth Slice: Registration successful",{user:a.payload.user.name,authenticated:!0})}).addCase(n.rejected,(e,a)=>{e.isLoading=!1;let s=a.payload;e.error=(null==s?void 0:s.errors)||["Registration failed"],console.log("❌ Auth Slice: Registration rejected",e.error)}),e.addCase(u.pending,e=>{e.isLoading=!0,e.error=null,console.log("⏳ Auth Slice: Login pending")}).addCase(u.fulfilled,(e,a)=>{e.isLoading=!1,e.user=a.payload.user,e.token=a.payload.token,e.isAuthenticated=!0,e.error=null,console.log("✅ Auth Slice: Login successful",{user:a.payload.user.name,authenticated:!0})}).addCase(u.rejected,(e,a)=>{e.isLoading=!1;let s=a.payload;e.error=(null==s?void 0:s.errors)||["Login failed"],console.log("❌ Auth Slice: Login rejected",e.error)}),e.addCase(i.pending,e=>{e.isLoading=!0,console.log("⏳ Auth Slice: Logout pending")}).addCase(i.fulfilled,e=>{e.isLoading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=null,console.log("✅ Auth Slice: Logout successful")}).addCase(i.rejected,e=>{e.isLoading=!1,e.user=null,e.token=null,e.isAuthenticated=!1,e.error=null,console.log("⚠️ Auth Slice: Logout failed on server but local data cleared")}),e.addCase(c.pending,e=>{e.isLoading=!0,console.log("⏳ Auth Slice: Get profile pending")}).addCase(c.fulfilled,(e,a)=>{e.isLoading=!1,e.user=a.payload,e.error=null,console.log("✅ Auth Slice: Get profile successful",{user:a.payload.name})}).addCase(c.rejected,(e,a)=>{e.isLoading=!1;let s=a.payload;e.error=(null==s?void 0:s.errors)||[(null==s?void 0:s.message)||"Failed to fetch profile"],console.log("❌ Auth Slice: Get profile rejected",e.error)}),e.addCase(p.pending,e=>{e.isLoading=!0,console.log("⏳ Auth Slice: Update profile pending")}).addCase(p.fulfilled,(e,a)=>{var s,r;e.isLoading=!1;let t=e.user;e.user={...a.payload},e.lastUpdated=Date.now(),e.error=null,console.log("✅ Auth Slice: Update profile successful",{previousUser:t?{id:t.id,name:t.name,bio:(null==(s=t.bio)?void 0:s.substring(0,30))+"..."}:null,updatedUser:{id:a.payload.id,name:a.payload.name,bio:(null==(r=a.payload.bio)?void 0:r.substring(0,30))+"..."},userChanged:(null==t?void 0:t.name)!==a.payload.name||(null==t?void 0:t.bio)!==a.payload.bio,lastUpdated:e.lastUpdated})}).addCase(p.rejected,(e,a)=>{e.isLoading=!1;let s=a.payload;e.error=(null==s?void 0:s.errors)||[(null==s?void 0:s.message)||"Failed to update profile"],console.log("❌ Auth Slice: Update profile rejected",e.error)}),e.addCase(g.pending,e=>{e.isLoading=!0,console.log("⏳ Auth Slice: Update password pending")}).addCase(g.fulfilled,(e,a)=>{e.isLoading=!1,e.error=null,console.log("✅ Auth Slice: Update password successful",{message:a.payload})}).addCase(g.rejected,(e,a)=>{e.isLoading=!1;let s=a.payload;e.error=(null==s?void 0:s.errors)||[(null==s?void 0:s.message)||"Failed to update password"],console.log("❌ Auth Slice: Update password rejected",e.error)}),e.addCase(h.pending,()=>{console.log("⏳ Auth Slice: Refresh user data pending")}).addCase(h.fulfilled,(e,a)=>{e.user=a.payload,e.error=null,console.log("✅ Auth Slice: Refresh user data successful",{user:a.payload.name})}).addCase(h.rejected,(e,a)=>{let s=a.payload;e.error=(null==s?void 0:s.errors)||[(null==s?void 0:s.message)||"Failed to refresh user data"],console.log("❌ Auth Slice: Refresh user data rejected",e.error)})}}),{clearError:v,clearAuth:m,setLoading:A,setUser:y,forceUpdateUser:S}=f.actions,w=f.reducer}}]);